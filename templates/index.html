<!-- Version: v4.3 | Date: 06/27/2025 | Sync with updated app.py and environment setup -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Santaâ€™s Workshop Hotline</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <h1>Santaâ€™s Workshop Hotline</h1>
    <label for="voice">Choose a voice:</label>
    <select id="voice">
      {% for voice in voices %}
        <option value="{{ voice }}">{{ voice }}</option>
      {% endfor %}
    </select>

    <input type="text" id="text" placeholder="Type your message here" />
    <button onclick="sendToBernard()">Send to Bernard</button>
    <button onclick="toggleNightMode()">Toggle Night Mode</button>
    <p id="thinking" style="display:none;">ðŸŽ„ Bernard is thinking...</p>
    <audio id="audio" controls style="width: 100%; margin-top: 20px;"></audio>
  </div>

  <script>
    async function sendToBernard() {
      const text = document.getElementById("text").value;
      const voice = document.getElementById("voice").value;
      const thinking = document.getElementById("thinking");
      const audio = document.getElementById("audio");

      if (!text) {
        alert("Please enter a message.");
        return;
      }

      thinking.style.display = "block";
      audio.src = "";
      
      try {
        const response = await fetch("/api/speak", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text, voice })
        });

        if (!response.ok) {
          const error = await response.json();
          alert(error.error || "Something went wrong!");
          thinking.style.display = "none";
          return;
        }

        const blob = await response.blob();
        audio.src = URL.createObjectURL(blob);
        audio.play();
      } catch (err) {
        alert("Something went wrong!");
        console.error(err);
      } finally {
        thinking.style.display = "none";
      }
    }

    function toggleNightMode() {
      document.body.classList.toggle("night");
    }
  </script>
</body>
</html>
